import React, { useState, useRef, useEffect } from 'react';
import { View, ScrollView, Text, ImageBackground, TouchableOpacity, Animated } from 'react-native';
import { LinearGradient } from 'expo-linear-gradient';
import { Feather } from '@expo/vector-icons';
import Slider from '@react-native-community/slider';
import { useFonts } from 'expo-font';
import AppLoading from 'expo-app-loading';

type Props = {
  navigation: any;
  route: {
    params: {
      subject: string;
      userType: 'student' | 'teacher';
    };
  };
};

// Paper weightages for different subjects and levels
const paperWeightages = {
  'ENGLISH A LIT': {
    HL: {
      'PAPER ONE': 0.30,        // 30%
      'PAPER TWO': 0.20,        // 20%
      'ESSAY': 0.20,            // 20%
      'INTERNAL ASSESSMENT (ORAL)': 0.30  // 30%
    },
    SL: {
      'PAPER ONE': 0.35,        // 35%
      'PAPER TWO': 0.35,        // 35%
      'INTERNAL ASSESSMENT (ORAL)': 0.30  // 30%
    }
  },
  'ENGLISH A LAL': {
    HL: {
      'PAPER ONE': 0.35,        // 35%
      'PAPER TWO': 0.25,        // 25%
      'ESSAY': 0.20,            // 20%
      'INTERNAL ASSESSMENT (ORAL)': 0.20  // 20%
    },
    SL: {
      'PAPER ONE': 0.35,        // 35%
      'PAPER TWO': 0.35,        // 35%
      'INTERNAL ASSESSMENT (ORAL)': 0.30  // 30%
    }
  },
  'ENGLISH A LIT AND PERF': {
    HL: {
      'TRANSFORMATIVE PERFORMANCE': 0.40,  // 40%
      'PAPER ONE': 0.30,        // 30%
      'WRITTEN ASSIGNMENT': 0.30  // 30%
    },
    SL: {
      'TRANSFORMATIVE PERFORMANCE': 0.40,  // 40%
      'PAPER ONE': 0.30,        // 30%
      'WRITTEN ASSIGNMENT': 0.30  // 30%
    }
  },
  'MATH ANALYSIS': {
    HL: {
      'PAPER ONE': 0.30,        // 30%
      'PAPER TWO': 0.30,        // 30%
      'PAPER THREE': 0.20,      // 20%
      'EXPLORATION': 0.20       // 20%
    },
    SL: {
      'PAPER ONE': 0.40,        // 40%
      'PAPER TWO': 0.40,        // 40%
      'EXPLORATION': 0.20       // 20%
    }
  },
  'MATH AI': {
    HL: {
      'PAPER ONE': 0.30,        // 30%
      'PAPER TWO': 0.30,        // 30%
      'PAPER THREE': 0.20,      // 20%
      'EXPLORATION': 0.20       // 20%
    },
    SL: {
      'PAPER ONE': 0.40,        // 40%
      'PAPER TWO': 0.40,        // 40%
      'EXPLORATION': 0.20       // 20%
    }
  },
  'GLOBAL POLITICS': {
    HL: {
      'EXTENSION ORAL': 0.20,        // 20%
      'INTERNAL ASSESSMENT': 0.20,  // 20%
      'PAPER ONE': 0.20,            // 20%
      'PAPER TWO': 0.40             // 40%
    },
    SL: {
      'INTERNAL ASSESSMENT': 0.25,  // 25%
      'PAPER ONE': 0.30,            // 30%
      'PAPER TWO': 0.45             // 45%
    }
  },
  'HISTORY': {

    SL: {
      'PAPER ONE': 0.3,
      'PAPER TWO': 0.45,
      'INTERNAL ASSESSMENT': 0.25
    }
  },
  'PHILOSOPHY': {
    HL: {
      'PAPER ONE': 0.4,
      'PAPER TWO': 0.2,
      'PAPER THREE': 0.2,
      'INTERNAL ASSESSMENT': 0.2
    },
    SL: {
      'PAPER ONE': 0.5,
      'PAPER TWO': 0.25,
      'INTERNAL ASSESSMENT': 0.25
    }
  }
};

// Grade boundaries data from the screenshot
const gradeBoundaries = {
  'ENGLISH A LIT': {
    HL: {
      november: {
        timezone0: {
          ESSAY: { 1: [0, 3], 2: [4, 6], 3: [7, 9], 4: [10, 12], 5: [13, 14], 6: [15, 17], 7: [18, 20] },
          'INTERNAL ASSESSMENT (ORAL)': { 1: [0, 6], 2: [7, 12], 3: [13, 18], 4: [19, 23], 5: [24, 28], 6: [29, 33], 7: [34, 40] },
          'PAPER ONE': { 1: [0, 4], 2: [5, 8], 3: [9, 15], 4: [16, 19], 5: [20, 23], 6: [24, 27], 7: [28, 40] },
          'PAPER TWO': { 1: [0, 3], 2: [4, 6], 3: [7, 9], 4: [10, 13], 5: [14, 17], 6: [18, 21], 7: [22, 30] },
          FINAL: { 1: [0, 12], 2: [13, 24], 3: [25, 39], 4: [40, 51], 5: [52, 62], 6: [63, 75], 7: [76, 100] }
        },
        timezone1: {
          EXPLORATION: { 1: [0, 2], 2: [3, 5], 3: [6, 8], 4: [9, 11], 5: [12, 14], 6: [15, 16], 7: [17, 20] },
          'PAPER ONE': { 1: [0, 9], 2: [10, 23], 3: [24, 34], 4: [35, 49], 5: [50, 63], 6: [64, 79], 7: [80, 110] },
          'PAPER THREE': { 1: [0, 5], 2: [6, 14], 3: [15, 22], 4: [23, 30], 5: [31, 36], 6: [37, 45], 7: [46, 55] },
          'PAPER TWO': { 1: [0, 9], 2: [10, 22], 3: [23, 33], 4: [34, 48], 5: [49, 62], 6: [63, 78], 7: [79, 110] },
          FINAL: { 1: [0, 9], 2: [10, 22], 3: [23, 34], 4: [35, 48], 5: [49, 61], 6: [62, 75], 7: [76, 100] }
        },
        timezone2: {
          EXPLORATION: { 1: [0, 2], 2: [3, 5], 3: [6, 8], 4: [9, 11], 5: [12, 14], 6: [15, 16], 7: [17, 20] },
          'PAPER ONE': { 1: [0, 13], 2: [14, 23], 3: [24, 36], 4: [37, 47], 5: [48, 56], 6: [57, 65], 7: [66, 80] },
          'PAPER TWO': { 1: [0, 9], 2: [10, 18], 3: [19, 29], 4: [30, 40], 5: [41, 51], 6: [52, 60], 7: [61, 75] },
          FINAL: { 1: [0, 13], 2: [14, 26], 3: [27, 41], 4: [42, 56], 5: [57, 69], 6: [70, 81], 7: [82, 100] }
        },
      },
      may: {
        timezone1: {
          ESSAY: { 1: [0, 3], 2: [4, 6], 3: [7, 9], 4: [10, 12], 5: [13, 14], 6: [15, 17], 7: [18, 20] },
          'INTERNAL ASSESSMENT (ORAL)': { 1: [0, 6], 2: [7, 12], 3: [13, 18], 4: [19, 23], 5: [24, 28], 6: [29, 33], 7: [34, 40] },
          'PAPER ONE': { 1: [0, 6], 2: [7, 12], 3: [13, 15], 4: [16, 20], 5: [21, 26], 6: [27, 31], 7: [32, 40] },
          'PAPER TWO': { 1: [0, 2], 2: [3, 5], 3: [6, 8], 4: [9, 13], 5: [14, 17], 6: [18, 22], 7: [23, 30] },
          FINAL: { 1: [0, 13], 2: [14, 27], 3: [28, 38], 4: [39, 52], 5: [53, 65], 6: [66, 79], 7: [80, 100] }
        },
        timezone2: {
          ESSAY: { 1: [0, 3], 2: [4, 6], 3: [7, 9], 4: [10, 12], 5: [13, 14], 6: [15, 17], 7: [18, 20] },
          'INTERNAL ASSESSMENT (ORAL)': { 1: [0, 6], 2: [7, 12], 3: [13, 18], 4: [19, 23], 5: [24, 28], 6: [29, 33], 7: [34, 40] },
          'PAPER ONE': { 1: [0, 7], 2: [8, 14], 3: [15, 16], 4: [17, 21], 5: [22, 25], 6: [26, 30], 7: [31, 40] },
          'PAPER TWO': { 1: [0, 2], 2: [3, 5], 3: [6, 8], 4: [9, 13], 5: [14, 18], 6: [19, 23], 7: [24, 30] },
          FINAL: { 1: [0, 14], 2: [15, 28], 3: [29, 39], 4: [40, 53], 5: [54, 65], 6: [66, 79], 7: [80, 100] }
        }
      }
    },
    SL: {
      november: {
        timezone1: {
          'INTERNAL ASSESSMENT (ORAL)': { 1: [0, 6], 2: [7, 12], 3: [13, 18], 4: [19, 23], 5: [24, 28], 6: [29, 33], 7: [34, 40] },
          'PAPER ONE': { 1: [0, 2], 2: [3, 4], 3: [5, 6], 4: [7, 9], 5: [10, 12], 6: [13, 15], 7: [16, 20] },
          'PAPER TWO': { 1: [0, 3], 2: [4, 7], 3: [8, 11], 4: [12, 16], 5: [17, 20], 6: [21, 25], 7: [26, 30] },
          FINAL: { 1: [0, 11], 2: [12, 24], 3: [25, 37], 4: [38, 52], 5: [53, 65], 6: [66, 80], 7: [81, 100] }
        },
        timezone2: {
          'INTERNAL ASSESSMENT (ORAL)': { 1: [0, 6], 2: [7, 12], 3: [13, 18], 4: [19, 23], 5: [24, 28], 6: [29, 33], 7: [34, 40] },
          'PAPER ONE': { 1: [0, 2], 2: [3, 4], 3: [5, 7], 4: [8, 10], 5: [11, 13], 6: [14, 16], 7: [17, 20] },
          'PAPER TWO': { 1: [0, 3], 2: [4, 7], 3: [8, 11], 4: [12, 16], 5: [17, 20], 6: [21, 25], 7: [26, 30] },
          FINAL: { 1: [0, 13], 2: [14, 29], 3: [30, 44], 4: [45, 57], 5: [58, 69], 6: [70, 82], 7: [83, 100] }
        },
        timezone0: {
          'INTERNAL ASSESSMENT (ORAL)': { 1: [0, 6], 2: [7, 12], 3: [13, 18], 4: [19, 23], 5: [24, 28], 6: [29, 33], 7: [34, 40] },
          'PAPER ONE': { 1: [0, 2], 2: [3, 4], 3: [5, 6], 4: [7, 9], 5: [10, 12], 6: [13, 15], 7: [16, 20] },
          'PAPER TWO': { 1: [0, 3], 2: [4, 7], 3: [8, 11], 4: [12, 16], 5: [17, 20], 6: [21, 25], 7: [26, 30] },
          FINAL: { 1: [0, 11], 2: [12, 24], 3: [25, 37], 4: [38, 52], 5: [53, 65], 6: [66, 80], 7: [81, 100] }
        }
      },
      may: {
        timezone1: {
          'INTERNAL ASSESSMENT (ORAL)': { 1: [0, 6], 2: [7, 12], 3: [13, 19], 4: [20, 22], 5: [23, 25], 6: [26, 28], 7: [29, 32] },
          'PAPER ONE': { 1: [0, 2], 2: [3, 5], 3: [6, 8], 4: [9, 13], 5: [14, 18], 6: [19, 23], 7: [24, 30] },
          'PAPER TWO': { 1: [0, 3], 2: [4, 6], 3: [7, 9], 4: [10, 13], 5: [14, 17], 6: [18, 21], 7: [22, 26] },
          FINAL: { 1: [0, 12], 2: [13, 26], 3: [27, 42], 4: [43, 55], 5: [56, 70], 6: [71, 83], 7: [84, 100] }
        },
        timezone2: {
          'INTERNAL ASSESSMENT (ORAL)': { 1: [0, 6], 2: [7, 12], 3: [13, 19], 4: [20, 22], 5: [23, 25], 6: [26, 28], 7: [29, 32] },
          'PAPER ONE': { 1: [0, 2], 2: [3, 5], 3: [6, 8], 4: [9, 13], 5: [14, 18], 6: [19, 23], 7: [24, 30] },
          'PAPER TWO': { 1: [0, 2], 2: [3, 5], 3: [6, 9], 4: [10, 13], 5: [14, 18], 6: [19, 22], 7: [23, 26] },
          FINAL: { 1: [0, 12], 2: [13, 26], 3: [27, 42], 4: [43, 55], 5: [56, 70], 6: [71, 83], 7: [84, 100] }
        }
      }
    }
  },
  'ENGLISH A LAL': {
    HL: {
      november: {
        timezone1: {
          ESSAY: { 1: [0, 3], 2: [4, 6], 3: [7, 9], 4: [10, 12], 5: [13, 14], 6: [15, 17], 7: [18, 20] },
          'INTERNAL ASSESSMENT (ORAL)': { 1: [0, 6], 2: [7, 12], 3: [13, 18], 4: [19, 23], 5: [24, 28], 6: [29, 33], 7: [34, 40] },
          'PAPER ONE': { 1: [0, 6], 2: [7, 12], 3: [13, 18], 4: [19, 23], 5: [24, 27], 6: [28, 32], 7: [33, 40] },
          'PAPER TWO': { 1: [0, 3], 2: [4, 6], 3: [7, 9], 4: [10, 13], 5: [14, 17], 6: [18, 21], 7: [22, 30] },
          FINAL: { 1: [0, 14], 2: [15, 27], 3: [28, 41], 4: [42, 54], 5: [55, 66], 6: [67, 79], 7: [80, 100] }
        },
        timezone2: {
          ESSAY: { 1: [0, 3], 2: [4, 6], 3: [7, 9], 4: [10, 12], 5: [13, 14], 6: [15, 17], 7: [18, 20] },
          'INTERNAL ASSESSMENT (ORAL)': { 1: [0, 6], 2: [7, 12], 3: [13, 18], 4: [19, 23], 5: [24, 28], 6: [29, 33], 7: [34, 40] },
          'PAPER ONE': { 1: [0, 5], 2: [6, 11], 3: [12, 17], 4: [18, 22], 5: [23, 27], 6: [28, 32], 7: [33, 40] },
          'PAPER TWO': { 1: [0, 3], 2: [4, 7], 3: [8, 11], 4: [12, 16], 5: [17, 20], 6: [21, 25], 7: [26, 30] },
          FINAL: { 1: [0, 13], 2: [14, 27], 3: [28, 42], 4: [43, 56], 5: [57, 68], 6: [69, 82], 7: [83, 100] }
        }
      },
      may: {
        timezone1: {
          ESSAY: { 1: [0, 3], 2: [4, 6], 3: [7, 9], 4: [10, 12], 5: [13, 14], 6: [15, 17], 7: [18, 20] },
          'INTERNAL ASSESSMENT (ORAL)': { 1: [0, 6], 2: [7, 12], 3: [13, 18], 4: [19, 23], 5: [24, 28], 6: [29, 33], 7: [34, 40] },
          'PAPER ONE': { 1: [0, 5], 2: [6, 10], 3: [11, 16], 4: [17, 20], 5: [21, 25], 6: [26, 29], 7: [30, 40] },
          'PAPER TWO': { 1: [0, 2], 2: [3, 5], 3: [6, 8], 4: [9, 13], 5: [14, 17], 6: [18, 22], 7: [23, 30] },
          FINAL: { 1: [0, 12], 2: [13, 25], 3: [26, 39], 4: [40, 52], 5: [53, 64], 6: [65, 77], 7: [78, 100] }
        },
        timezone2: {
          ESSAY: { 1: [0, 3], 2: [4, 6], 3: [7, 9], 4: [10, 12], 5: [13, 14], 6: [15, 17], 7: [18, 20] },
          'INTERNAL ASSESSMENT (ORAL)': { 1: [0, 6], 2: [7, 12], 3: [13, 18], 4: [19, 23], 5: [24, 28], 6: [29, 33], 7: [34, 40] },
          'PAPER ONE': { 1: [0, 4], 2: [5, 9], 3: [10, 15], 4: [16, 20], 5: [21, 25], 6: [26, 30], 7: [31, 40] },
          'PAPER TWO': { 1: [0, 3], 2: [4, 7], 3: [8, 11], 4: [12, 16], 5: [17, 20], 6: [21, 25], 7: [26, 30] },
          FINAL: { 1: [0, 11], 2: [12, 24], 3: [25, 38], 4: [39, 52], 5: [53, 65], 6: [66, 79], 7: [80, 100] }
        }
      }
    },
    SL: {
      november: {
        timezone1: {
          'INTERNAL ASSESSMENT (ORAL)': { 1: [0, 6], 2: [7, 12], 3: [13, 19], 4: [20, 22], 5: [23, 25], 6: [26, 28], 7: [29, 32] },
          'PAPER ONE': { 1: [0, 2], 2: [3, 5], 3: [6, 8], 4: [9, 13], 5: [14, 18], 6: [19, 23], 7: [24, 30] },
          'PAPER TWO': { 1: [0, 2], 2: [3, 5], 3: [6, 9], 4: [10, 13], 5: [14, 18], 6: [19, 22], 7: [23, 26] },
          FINAL: { 1: [0, 12], 2: [13, 26], 3: [27, 42], 4: [43, 55], 5: [56, 70], 6: [71, 83], 7: [84, 100] }
        },
        timezone2: {
          'INTERNAL ASSESSMENT (ORAL)': { 1: [0, 6], 2: [7, 12], 3: [13, 19], 4: [20, 22], 5: [23, 25], 6: [26, 28], 7: [29, 32] },
          'PAPER ONE': { 1: [0, 2], 2: [3, 5], 3: [6, 8], 4: [9, 13], 5: [14, 18], 6: [19, 23], 7: [24, 30] },
          'PAPER TWO': { 1: [0, 2], 2: [3, 5], 3: [6, 9], 4: [10, 13], 5: [14, 18], 6: [19, 22], 7: [23, 26] },
          FINAL: { 1: [0, 12], 2: [13, 26], 3: [27, 42], 4: [43, 55], 5: [56, 70], 6: [71, 83], 7: [84, 100] }
        }
      },
      may: {
        timezone1: {
          'INTERNAL ASSESSMENT (ORAL)': { 1: [0, 6], 2: [7, 12], 3: [13, 19], 4: [20, 22], 5: [23, 25], 6: [26, 28], 7: [29, 32] },
          'PAPER ONE': { 1: [0, 2], 2: [3, 5], 3: [6, 8], 4: [9, 13], 5: [14, 18], 6: [19, 23], 7: [24, 30] },
          'PAPER TWO': { 1: [0, 2], 2: [3, 5], 3: [6, 9], 4: [10, 13], 5: [14, 18], 6: [19, 22], 7: [23, 26] },
          FINAL: { 1: [0, 12], 2: [13, 26], 3: [27, 42], 4: [43, 55], 5: [56, 70], 6: [71, 83], 7: [84, 100] }
        },
        timezone2: {
          'INTERNAL ASSESSMENT (ORAL)': { 1: [0, 6], 2: [7, 12], 3: [13, 19], 4: [20, 22], 5: [23, 25], 6: [26, 28], 7: [29, 32] },
          'PAPER ONE': { 1: [0, 2], 2: [3, 5], 3: [6, 8], 4: [9, 13], 5: [14, 18], 6: [19, 23], 7: [24, 30] },
          'PAPER TWO': { 1: [0, 2], 2: [3, 5], 3: [6, 9], 4: [10, 13], 5: [14, 18], 6: [19, 22], 7: [23, 26] },
          FINAL: { 1: [0, 12], 2: [13, 26], 3: [27, 42], 4: [43, 55], 5: [56, 70], 6: [71, 83], 7: [84, 100] }
        }
      }
    }
  },
  'ENGLISH A LIT AND PERF': {
    HL: {
      november: {
        timezone1: {
          'TRANSFORMATIVE PERFORMANCE': { 1: [0, 6], 2: [7, 12], 3: [13, 18], 4: [19, 23], 5: [24, 28], 6: [29, 33], 7: [34, 40] },
          'PAPER ONE': { 1: [0, 2], 2: [3, 4], 3: [5, 6], 4: [7, 9], 5: [10, 12], 6: [13, 15], 7: [16, 20] },
          'WRITTEN ASSIGNMENT': { 1: [0, 3], 2: [4, 7], 3: [8, 11], 4: [12, 16], 5: [17, 20], 6: [21, 25], 7: [26, 30] },
          FINAL: { 1: [0, 11], 2: [12, 24], 3: [25, 37], 4: [38, 52], 5: [53, 65], 6: [66, 80], 7: [81, 100] }
        },
        timezone2: {
          'TRANSFORMATIVE PERFORMANCE': { 1: [0, 6], 2: [7, 12], 3: [13, 18], 4: [19, 23], 5: [24, 28], 6: [29, 33], 7: [34, 40] },
          'PAPER ONE': { 1: [0, 2], 2: [3, 4], 3: [5, 7], 4: [8, 10], 5: [11, 13], 6: [14, 16], 7: [17, 20] },
          'WRITTEN ASSIGNMENT': { 1: [0, 2], 2: [3, 5], 3: [6, 8], 4: [9, 13], 5: [14, 17], 6: [18, 22], 7: [23, 30] },
          FINAL: { 1: [0, 10], 2: [11, 22], 3: [23, 35], 4: [36, 50], 5: [51, 64], 6: [65, 78], 7: [79, 100] }
        }
      },
      may: {
        timezone1: {
          'TRANSFORMATIVE PERFORMANCE': { 1: [0, 6], 2: [7, 12], 3: [13, 19], 4: [20, 22], 5: [23, 25], 6: [26, 28], 7: [29, 32] },
          'PAPER ONE': { 1: [0, 2], 2: [3, 5], 3: [6, 8], 4: [9, 13], 5: [14, 18], 6: [19, 23], 7: [24, 30] },
          'WRITTEN ASSIGNMENT': { 1: [0, 2], 2: [3, 5], 3: [6, 9], 4: [10, 13], 5: [14, 18], 6: [19, 22], 7: [23, 26] },
          FINAL: { 1: [0, 12], 2: [13, 26], 3: [27, 42], 4: [43, 55], 5: [56, 70], 6: [71, 83], 7: [84, 100] }
        },
        timezone2: {
          'TRANSFORMATIVE PERFORMANCE': { 1: [0, 6], 2: [7, 12], 3: [13, 19], 4: [20, 22], 5: [23, 25], 6: [26, 28], 7: [29, 32] },
          'PAPER ONE': { 1: [0, 2], 2: [3, 5], 3: [6, 8], 4: [9, 13], 5: [14, 18], 6: [19, 23], 7: [24, 30] },
          'WRITTEN ASSIGNMENT': { 1: [0, 2], 2: [3, 5], 3: [6, 9], 4: [10, 13], 5: [14, 18], 6: [19, 22], 7: [23, 26] },
          FINAL: { 1: [0, 12], 2: [13, 26], 3: [27, 42], 4: [43, 55], 5: [56, 70], 6: [71, 83], 7: [84, 100] }
        }
      }
    },
    SL: {
      november: {
        timezone1: {
          'TRANSFORMATIVE PERFORMANCE': { 1: [0, 6], 2: [7, 12], 3: [13, 19], 4: [20, 22], 5: [23, 25], 6: [26, 28], 7: [29, 32] },
          'PAPER ONE': { 1: [0, 2], 2: [3, 5], 3: [6, 8], 4: [9, 13], 5: [14, 18], 6: [19, 23], 7: [24, 30] },
          'WRITTEN ASSIGNMENT': { 1: [0, 2], 2: [3, 5], 3: [6, 9], 4: [10, 13], 5: [14, 18], 6: [19, 22], 7: [23, 26] },
          FINAL: { 1: [0, 12], 2: [13, 26], 3: [27, 42], 4: [43, 55], 5: [56, 70], 6: [71, 83], 7: [84, 100] }
        },
        timezone2: {
          'TRANSFORMATIVE PERFORMANCE': { 1: [0, 6], 2: [7, 12], 3: [13, 19], 4: [20, 22], 5: [23, 25], 6: [26, 28], 7: [29, 32] },
          'PAPER ONE': { 1: [0, 2], 2: [3, 5], 3: [6, 8], 4: [9, 13], 5: [14, 18], 6: [19, 23], 7: [24, 30] },
          'WRITTEN ASSIGNMENT': { 1: [0, 2], 2: [3, 5], 3: [6, 9], 4: [10, 13], 5: [14, 18], 6: [19, 22], 7: [23, 26] },
          FINAL: { 1: [0, 12], 2: [13, 26], 3: [27, 42], 4: [43, 55], 5: [56, 70], 6: [71, 83], 7: [84, 100] }
        }
      },
      may: {
        timezone1: {
          'TRANSFORMATIVE PERFORMANCE': { 1: [0, 6], 2: [7, 12], 3: [13, 19], 4: [20, 22], 5: [23, 25], 6: [26, 28], 7: [29, 32] },
          'PAPER ONE': { 1: [0, 2], 2: [3, 5], 3: [6, 8], 4: [9, 13], 5: [14, 18], 6: [19, 23], 7: [24, 30] },
          'WRITTEN ASSIGNMENT': { 1: [0, 2], 2: [3, 5], 3: [6, 9], 4: [10, 13], 5: [14, 18], 6: [19, 22], 7: [23, 26] },
          FINAL: { 1: [0, 12], 2: [13, 26], 3: [27, 42], 4: [43, 55], 5: [56, 70], 6: [71, 83], 7: [84, 100] }
        },
        timezone2: {
          'TRANSFORMATIVE PERFORMANCE': { 1: [0, 6], 2: [7, 12], 3: [13, 19], 4: [20, 22], 5: [23, 25], 6: [26, 28], 7: [29, 32] },
          'PAPER ONE': { 1: [0, 2], 2: [3, 5], 3: [6, 8], 4: [9, 13], 5: [14, 18], 6: [19, 23], 7: [24, 30] },
          'WRITTEN ASSIGNMENT': { 1: [0, 2], 2: [3, 5], 3: [6, 9], 4: [10, 13], 5: [14, 18], 6: [19, 22], 7: [23, 26] },
          FINAL: { 1: [0, 12], 2: [13, 26], 3: [27, 42], 4: [43, 55], 5: [56, 70], 6: [71, 83], 7: [84, 100] }
        }
      }
    }
  },
  'MATH ANALYSIS': {
    HL: {
      november: {
        timezone1: {
          EXPLORATION: { 1: [0, 2], 2: [3, 5], 3: [6, 8], 4: [9, 11], 5: [12, 14], 6: [15, 16], 7: [17, 20] },
          'PAPER ONE': { 1: [0, 9], 2: [10, 23], 3: [24, 34], 4: [35, 49], 5: [50, 63], 6: [64, 79], 7: [80, 110] },
          'PAPER TWO': { 1: [0, 9], 2: [10, 22], 3: [23, 33], 4: [34, 48], 5: [49, 62], 6: [63, 78], 7: [79, 110] },
          FINAL: { 1: [0, 9], 2: [10, 22], 3: [23, 34], 4: [35, 48], 5: [49, 61], 6: [62, 75], 7: [76, 100] }
        },
        timezone2: {
          EXPLORATION: { 1: [0, 2], 2: [3, 5], 3: [6, 8], 4: [9, 11], 5: [12, 14], 6: [15, 16], 7: [17, 20] },
          'PAPER ONE': { 1: [0, 14], 2: [15, 22], 3: [23, 29], 4: [30, 44], 5: [45, 59], 6: [60, 75], 7: [76, 110] },
          'PAPER TWO': { 1: [0, 15], 2: [16, 24], 3: [25, 32], 4: [33, 47], 5: [48, 62], 6: [63, 79], 7: [80, 110] },
          FINAL: { 1: [0, 13], 2: [14, 23], 3: [24, 33], 4: [34, 46], 5: [47, 59], 6: [60, 73], 7: [74, 100] }
        },
        timezone0: {
          EXPLORATION: { 1: [0, 2], 2: [3, 5], 3: [6, 8], 4: [9, 11], 5: [12, 14], 6: [15, 16], 7: [17, 20] },
          'PAPER ONE': { 1: [0, 16], 2: [17, 30], 3: [31, 41], 4: [42, 54], 5: [55, 69], 6: [70, 82], 7: [83, 110] },
          'PAPER THREE': { 1: [0, 7], 2: [8, 13], 3: [14, 18], 4: [19, 25], 5: [26, 31], 6: [32, 36], 7: [37, 54] },
          'PAPER TWO': { 1: [0, 18], 2: [19, 34], 3: [35, 45], 4: [46, 59], 5: [60, 72], 6: [73, 87], 7: [88, 108] },
          FINAL: { 1: [0, 14], 2: [15, 27], 3: [28, 38], 4: [39, 51], 5: [52, 64], 6: [65, 76], 7: [77, 100] }
        }
      },
      may: {
        timezone1: {
          EXPLORATION: { 1: [0, 2], 2: [3, 5], 3: [6, 8], 4: [9, 11], 5: [12, 14], 6: [15, 17], 7: [18, 20] },
          'PAPER ONE': { 1: [0, 8], 2: [9, 17], 3: [18, 25], 4: [26, 35], 5: [36, 48], 6: [49, 58], 7: [59, 80] },
          'PAPER TWO': { 1: [0, 7], 2: [8, 16], 3: [17, 24], 4: [25, 35], 5: [36, 48], 6: [49, 58], 7: [59, 80] },
          FINAL: { 1: [0, 9], 2: [10, 21], 3: [22, 32], 4: [33, 46], 5: [47, 62], 6: [63, 75], 7: [76, 100] }
        },
        timezone2: {
          EXPLORATION: { 1: [0, 2], 2: [3, 5], 3: [6, 8], 4: [9, 11], 5: [12, 14], 6: [15, 17], 7: [18, 20] },
          'PAPER ONE': { 1: [0, 5], 2: [6, 11], 3: [12, 20], 4: [21, 31], 5: [32, 44], 6: [45, 57], 7: [58, 80] },
          'PAPER TWO': { 1: [0, 7], 2: [8, 13], 3: [14, 22], 4: [23, 33], 5: [34, 45], 6: [46, 58], 7: [59, 80] },
          FINAL: { 1: [0, 8], 2: [9, 17], 3: [18, 29], 4: [30, 43], 5: [44, 58], 6: [59, 74], 7: [75, 100] }
        }
      }
    },
    SL: {
      november: {
        timezone1: {
          EXPLORATION: { 1: [0, 2], 2: [3, 5], 3: [6, 8], 4: [9, 11], 5: [12, 14], 6: [15, 16], 7: [17, 20] },
          'PAPER ONE': { 1: [0, 10], 2: [11, 20], 3: [21, 28], 4: [29, 41], 5: [42, 53], 6: [54, 63], 7: [64, 80] },
          'PAPER TWO': { 1: [0, 10], 2: [11, 20], 3: [21, 28], 4: [29, 41], 5: [42, 52], 6: [53, 61], 7: [62, 80] },
          FINAL: { 1: [0, 12], 2: [13, 25], 3: [26, 36], 4: [37, 52], 5: [53, 66], 6: [67, 79], 7: [80, 100] }
        },
        timezone2: {
          EXPLORATION: { 1: [0, 2], 2: [3, 5], 3: [6, 8], 4: [9, 11], 5: [12, 14], 6: [15, 17], 7: [18, 20] },
          'PAPER ONE': { 1: [0, 10], 2: [11, 20], 3: [21, 28], 4: [29, 41], 5: [42, 52], 6: [53, 63], 7: [64, 80] },
          'PAPER TWO': { 1: [0, 10], 2: [11, 20], 3: [21, 28], 4: [29, 41], 5: [42, 52], 6: [53, 61], 7: [62, 80] },
          FINAL: { 1: [0, 12], 2: [13, 25], 3: [26, 36], 4: [37, 52], 5: [53, 66], 6: [67, 79], 7: [80, 100] }
        }
      },
      may: {
        timezone1: {
          EXPLORATION: { 1: [0, 2], 2: [3, 5], 3: [6, 8], 4: [9, 11], 5: [12, 14], 6: [15, 17], 7: [18, 20] },
          'PAPER ONE': { 1: [0, 8], 2: [9, 17], 3: [18, 25], 4: [26, 35], 5: [36, 48], 6: [49, 58], 7: [59, 80] },
          'PAPER TWO': { 1: [0, 7], 2: [8, 16], 3: [17, 24], 4: [25, 35], 5: [36, 48], 6: [49, 58], 7: [59, 80] },
          FINAL: { 1: [0, 9], 2: [10, 21], 3: [22, 32], 4: [33, 46], 5: [47, 62], 6: [63, 75], 7: [76, 100] }
        },
        timezone2: {
          EXPLORATION: { 1: [0, 2], 2: [3, 5], 3: [6, 8], 4: [9, 11], 5: [12, 14], 6: [15, 17], 7: [18, 20] },
          'PAPER ONE': { 1: [0, 5], 2: [6, 11], 3: [12, 20], 4: [21, 31], 5: [32, 44], 6: [45, 57], 7: [58, 80] },
          'PAPER TWO': { 1: [0, 7], 2: [8, 13], 3: [14, 22], 4: [23, 33], 5: [34, 45], 6: [46, 58], 7: [59, 80] },
          FINAL: { 1: [0, 8], 2: [9, 17], 3: [18, 29], 4: [30, 43], 5: [44, 58], 6: [59, 74], 7: [75, 100] }
        }
      }
    }
  },
  'MATH AI': {
    HL: {
      may: {
        timezone1: {
          EXPLORATION: { 1: [0, 2], 2: [3, 5], 3: [6, 8], 4: [9, 11], 5: [12, 14], 6: [15, 16], 7: [17, 20] },
          'PAPER ONE': { 1: [0, 14], 2: [15, 26], 3: [27, 35], 4: [36, 47], 5: [48, 57], 6: [58, 68], 7: [69, 110] },
          'PAPER THREE': { 1: [0, 7], 2: [8, 14], 3: [15, 21], 4: [22, 28], 5: [29, 35], 6: [36, 41], 7: [42, 55] },
          'PAPER TWO': { 1: [0, 15], 2: [16, 30], 3: [31, 41], 4: [42, 59], 5: [60, 74], 6: [75, 88], 7: [89, 110] },
          FINAL: { 1: [0, 12], 2: [13, 25], 3: [26, 36], 4: [37, 50], 5: [51, 62], 6: [63, 73], 7: [74, 100] }
        },
        timezone2: {
          EXPLORATION: { 1: [0, 2], 2: [3, 5], 3: [6, 8], 4: [9, 11], 5: [12, 14], 6: [15, 16], 7: [17, 20] },
          'PAPER ONE': { 1: [0, 15], 2: [16, 27], 3: [28, 36], 4: [37, 50], 5: [51, 65], 6: [66, 76], 7: [77, 110] },
          'PAPER THREE': { 1: [0, 6], 2: [7, 11], 3: [12, 16], 4: [17, 23], 5: [24, 30], 6: [31, 38], 7: [39, 55] },
          'PAPER TWO': { 1: [0, 15], 2: [16, 29], 3: [30, 39], 4: [40, 53], 5: [54, 69], 6: [70, 84], 7: [85, 110] },
          FINAL: { 1: [0, 12], 2: [13, 24], 3: [25, 34], 4: [35, 47], 5: [48, 61], 6: [62, 73], 7: [74, 100] }
        }
      },
      november: {
        timezone0: {
          EXPLORATION: { 1: [0, 2], 2: [3, 5], 3: [6, 8], 4: [9, 11], 5: [12, 14], 6: [15, 16], 7: [17, 20] },
          'PAPER ONE': { 1: [0, 13], 2: [14, 23], 3: [24, 36], 4: [37, 47], 5: [48, 56], 6: [57, 65], 7: [66, 80] },
          'PAPER TWO': { 1: [0, 9], 2: [10, 18], 3: [19, 29], 4: [30, 40], 5: [41, 51], 6: [52, 60], 7: [61, 75] },
          FINAL: { 1: [0, 13], 2: [14, 26], 3: [27, 41], 4: [42, 56], 5: [57, 69], 6: [70, 81], 7: [82, 100] }
        }
      }
    },
    SL: {
      may: {
        timezone1: {
          EXPLORATION: { 1: [0, 2], 2: [3, 5], 3: [6, 8], 4: [9, 11], 5: [12, 14], 6: [15, 17], 7: [18, 20] },
          'PAPER ONE': { 1: [0, 11], 2: [12, 19], 3: [20, 29], 4: [30, 38], 5: [39, 49], 6: [50, 57], 7: [58, 80] },
          'PAPER TWO': { 1: [0, 10], 2: [11, 20], 3: [21, 29], 4: [30, 40], 5: [41, 52], 6: [53, 62], 7: [63, 80] },
          FINAL: { 1: [0, 12], 2: [13, 24], 3: [25, 37], 4: [38, 50], 5: [51, 64], 6: [65, 76], 7: [77, 100] }
        },
        timezone2: {
          EXPLORATION: { 1: [0, 2], 2: [3, 5], 3: [6, 8], 4: [9, 11], 5: [12, 14], 6: [15, 17], 7: [18, 20] },
          'PAPER ONE': { 1: [0, 10], 2: [11, 19], 3: [20, 26], 4: [27, 36], 5: [37, 46], 6: [47, 58], 7: [59, 80] },
          'PAPER TWO': { 1: [0, 9], 2: [10, 18], 3: [19, 25], 4: [26, 35], 5: [36, 46], 6: [47, 59], 7: [60, 80] },
          FINAL: { 1: [0, 11], 2: [12, 23], 3: [24, 33], 4: [34, 46], 5: [47, 60], 6: [61, 75], 7: [76, 100] }
        },
      november: {
          timezone1: {
            EXPLORATION: { 1: [0, 2], 2: [3, 5], 3: [6, 8], 4: [9, 11], 5: [12, 14], 6: [15, 17], 7: [18, 20] },
            'PAPER ONE': { 1: [0, 14], 2: [14, 23], 3: [24, 36], 4: [37, 47], 5: [48, 56], 6: [57, 65], 7: [66, 80] },
            'PAPER TWO': { 1: [0, 9], 2: [10, 18], 3: [11, 29], 4: [30, 40], 5: [41, 51], 6: [52, 60], 7: [61, 75] },
            FINAL: { 1: [0, 13], 2: [14, 26], 3: [27, 41], 4: [42, 56], 5: [57, 69], 6: [70, 81], 7: [82, 100] }
          },
          timezone2: {
            EXPLORATION: { 1: [0, 2], 2: [3, 5], 3: [6, 8], 4: [9, 11], 5: [12, 14], 6: [15, 17], 7: [18, 20] },
            'PAPER ONE': { 1: [0, 14], 2: [14, 23], 3: [24, 36], 4: [37, 47], 5: [48, 56], 6: [57, 65], 7: [66, 80] },
            'PAPER TWO': { 1: [0, 9], 2: [10, 18], 3: [11, 29], 4: [30, 40], 5: [41, 51], 6: [52, 60], 7: [61, 75] },
            FINAL: { 1: [0, 13], 2: [14, 26], 3: [27, 41], 4: [42, 56], 5: [57, 69], 6: [70, 81], 7: [82, 100] }
          }
        }
      }
    }
  },
  'HISTORY': {
    SL: {
      may: {
        timezone1: {
          'INTERNAL ASSESSMENT': { 1: [0, 2], 2: [3, 5], 3: [6, 8], 4: [9, 12], 5: [13, 15], 6: [16, 19], 7: [20, 25] },
          'PAPER ONE': { 1: [0, 4], 2: [5, 8], 3: [9, 11], 4: [12, 14], 5: [15, 16], 6: [17, 19], 7: [20, 24] },
          'PAPER TWO': { 1: [0, 5], 2: [6, 10], 3: [11, 12], 4: [13, 15], 5: [16, 19], 6: [20, 22], 7: [23, 30] },
          FINAL: { 1: [0, 13], 2: [14, 28], 3: [29, 38], 4: [39, 52], 5: [53, 62], 6: [63, 76], 7: [77, 100] }
        },
        timezone2: {
          'INTERNAL ASSESSMENT': { 1: [0, 2], 2: [3, 5], 3: [6, 8], 4: [9, 12], 5: [13, 15], 6: [16, 19], 7: [20, 25] },
          'PAPER ONE': { 1: [0, 4], 2: [5, 8], 3: [9, 11], 4: [12, 14], 5: [15, 16], 6: [17, 19], 7: [20, 24] },
          'PAPER TWO': { 1: [0, 5], 2: [6, 10], 3: [11, 12], 4: [13, 15], 5: [16, 19], 6: [20, 22], 7: [23, 30] },
          FINAL: { 1: [0, 14], 2: [15, 30], 3: [31, 40], 4: [41, 52], 5: [53, 63], 6: [64, 76], 7: [77, 100] }
        }
      },
      november: {
        timezone1: {
          'INTERNAL ASSESSMENT': { 1: [0, 2], 2: [3, 5], 3: [6, 8], 4: [9, 12], 5: [13, 15], 6: [16, 19], 7: [20, 25] },
          'PAPER ONE': { 1: [0, 4], 2: [5, 8], 3: [9, 11], 4: [12, 14], 5: [15, 16], 6: [17, 19], 7: [20, 24] },
          'PAPER TWO': { 1: [0, 5], 2: [6, 10], 3: [11, 12], 4: [13, 15], 5: [16, 19], 6: [20, 22], 7: [23, 30] },
          FINAL: { 1: [0, 13], 2: [14, 28], 3: [29, 38], 4: [39, 52], 5: [53, 62], 6: [63, 76], 7: [77, 100] }
        },
        timezone2: {
          'INTERNAL ASSESSMENT': { 1: [0, 2], 2: [3, 5], 3: [6, 8], 4: [9, 12], 5: [13, 15], 6: [16, 19], 7: [20, 25] },
          'PAPER ONE': { 1: [0, 4], 2: [5, 8], 3: [9, 11], 4: [12, 14], 5: [15, 16], 6: [17, 19], 7: [20, 24] },
          'PAPER TWO': { 1: [0, 5], 2: [6, 10], 3: [11, 12], 4: [13, 15], 5: [16, 19], 6: [20, 22], 7: [23, 30] },
          FINAL: { 1: [0, 14], 2: [15, 30], 3: [31, 40], 4: [41, 52], 5: [53, 63], 6: [64, 76], 7: [77, 100] }
        }
      }
    }
  },
  'PHILOSOPHY': {
    HL: {
      may: {
        timezone1: {
          'INTERNAL ASSESSMENT': { 1: [0, 3], 2: [4, 7], 3: [8, 11], 4: [12, 15], 5: [16, 18], 6: [19, 21], 7: [22, 25] },
          'PAPER ONE': { 1: [0, 5], 2: [6, 10], 3: [11, 23], 4: [24, 35], 5: [36, 48], 6: [49, 60], 7: [61, 75] },
          'PAPER TWO': { 1: [0, 4], 2: [5, 8], 3: [9, 11], 4: [12, 14], 5: [15, 16], 6: [17, 19], 7: [20, 25] },
          'PAPER THREE': { 1: [0, 4], 2: [5, 8], 3: [9, 12], 4: [13, 14], 5: [15, 17], 6: [18, 19], 7: [20, 25] },
          FINAL: { 1: [0, 11], 2: [12, 24], 3: [25, 39], 4: [40, 53], 5: [54, 66], 6: [67, 79], 7: [80, 100] }
        },
        timezone2: {
          'INTERNAL ASSESSMENT': { 1: [0, 3], 2: [4, 7], 3: [8, 11], 4: [12, 15], 5: [16, 18], 6: [19, 21], 7: [22, 25] },
          'PAPER ONE': { 1: [0, 5], 2: [6, 10], 3: [11, 20], 4: [21, 31], 5: [32, 43], 6: [44, 54], 7: [55, 75] },
          'PAPER TWO': { 1: [0, 4], 2: [5, 8], 3: [9, 11], 4: [12, 14], 5: [15, 16], 6: [17, 19], 7: [20, 25] },
          'PAPER THREE': { 1: [0, 4], 2: [5, 8], 3: [9, 12], 4: [13, 14], 5: [15, 17], 6: [18, 19], 7: [20, 25] },
          FINAL: { 1: [0, 11], 2: [12, 24], 3: [25, 38], 4: [39, 51], 5: [52, 64], 6: [65, 76], 7: [77, 100] }
        },
        timezone0: {
          'INTERNAL ASSESSMENT': { 1: [0, 3], 2: [4, 7], 3: [8, 11], 4: [12, 15], 5: [16, 18], 6: [19, 21], 7: [22, 25] },
          'PAPER ONE': { 1: [0, 5], 2: [6, 10], 3: [11, 20], 4: [21, 31], 5: [32, 43], 6: [44, 54], 7: [55, 75] },
          'PAPER TWO': { 1: [0, 4], 2: [5, 8], 3: [9, 11], 4: [12, 14], 5: [15, 16], 6: [17, 19], 7: [20, 25] },
          'PAPER THREE': { 1: [0, 4], 2: [5, 8], 3: [9, 12], 4: [13, 14], 5: [15, 17], 6: [18, 19], 7: [20, 25] },
          FINAL: { 1: [0, 11], 2: [12, 24], 3: [25, 38], 4: [39, 51], 5: [52, 64], 6: [65, 76], 7: [77, 100] }
        }

      },
      november: {
        timezone0: {
          'INTERNAL ASSESSMENT': { 1: [0, 3], 2: [4, 7], 3: [8, 11], 4: [12, 15], 5: [16, 18], 6: [19, 21], 7: [22, 25] },
          'PAPER ONE': { 1: [0, 6], 2: [7, 13], 3: [14, 26], 4: [27, 37], 5: [38, 48], 6: [49, 59], 7: [60, 75] },
          'PAPER THREE': { 1: [0, 2], 2: [3, 5], 3: [6, 9], 4: [10, 13], 5: [14, 16], 6: [17, 20], 7: [21, 25] },
          'PAPER TWO': { 1: [0, 3], 2: [4, 7], 3: [8, 11], 4: [12, 14], 5: [15, 17], 6: [18, 20], 7: [21, 25] },
          FINAL: { 1: [0, 10], 2: [11, 22], 3: [23, 39], 4: [40, 53], 5: [54, 66], 6: [67, 80], 7: [81, 100] }
        },
        timezone1: {
          'INTERNAL ASSESSMENT': { 1: [0, 3], 2: [4, 7], 3: [8, 11], 4: [12, 15], 5: [16, 18], 6: [19, 21], 7: [22, 25] },
          'PAPER ONE': { 1: [0, 6], 2: [7, 13], 3: [14, 26], 4: [27, 37], 5: [38, 48], 6: [49, 59], 7: [60, 75] },
          'PAPER THREE': { 1: [0, 2], 2: [3, 5], 3: [6, 9], 4: [10, 13], 5: [14, 16], 6: [17, 20], 7: [21, 25] },
          'PAPER TWO': { 1: [0, 3], 2: [4, 7], 3: [8, 11], 4: [12, 14], 5: [15, 17], 6: [18, 20], 7: [21, 25] },
          FINAL: { 1: [0, 10], 2: [11, 22], 3: [23, 39], 4: [40, 53], 5: [54, 66], 6: [67, 80], 7: [81, 100] }
        },
        timezone2: {
          'INTERNAL ASSESSMENT': { 1: [0, 3], 2: [4, 7], 3: [8, 11], 4: [12, 15], 5: [16, 18], 6: [19, 21], 7: [22, 25] },
          'PAPER ONE': { 1: [0, 6], 2: [7, 13], 3: [14, 26], 4: [27, 37], 5: [38, 48], 6: [49, 59], 7: [60, 75] },
          'PAPER THREE': { 1: [0, 2], 2: [3, 5], 3: [6, 9], 4: [10, 13], 5: [14, 16], 6: [17, 20], 7: [21, 25] },
          'PAPER TWO': { 1: [0, 3], 2: [4, 7], 3: [8, 11], 4: [12, 14], 5: [15, 17], 6: [18, 20], 7: [21, 25] },
          FINAL: { 1: [0, 10], 2: [11, 22], 3: [23, 39], 4: [40, 53], 5: [54, 66], 6: [67, 80], 7: [81, 100] }
        }
      }
    },
    SL: {
      may: {
        timezone1: {
          'INTERNAL ASSESSMENT': { 1: [0, 3], 2: [4, 7], 3: [8, 11], 4: [12, 15], 5: [16, 18], 6: [19, 21], 7: [22, 25] },
          'PAPER ONE': { 1: [0, 5], 2: [6, 10], 3: [11, 15], 4: [16, 22], 5: [23, 31], 6: [32, 38], 7: [39, 50] },
          'PAPER TWO': { 1: [0, 4], 2: [5, 8], 3: [9, 11], 4: [12, 14], 5: [15, 16], 6: [17, 19], 7: [20, 25] },
          FINAL: { 1: [0, 12], 2: [13, 25], 3: [26, 37], 4: [38, 51], 5: [52, 65], 6: [66, 78], 7: [79, 100] }
        },
        timezone2: {
          'INTERNAL ASSESSMENT': { 1: [0, 3], 2: [4, 7], 3: [8, 11], 4: [12, 15], 5: [16, 18], 6: [19, 21], 7: [22, 25] },
          'PAPER ONE': { 1: [0, 7], 2: [8, 14], 3: [15, 21], 4: [22, 26], 5: [27, 31], 6: [32, 36], 7: [37, 50] },
          'PAPER TWO': { 1: [0, 4], 2: [5, 8], 3: [9, 11], 4: [12, 14], 5: [15, 16], 6: [17, 19], 7: [20, 25] },
          FINAL: { 1: [0, 14], 2: [15, 29], 3: [30, 43], 4: [44, 55], 5: [56, 65], 6: [66, 76], 7: [77, 100] }
        },
        timezone0: {
          'INTERNAL ASSESSMENT': { 1: [0, 3], 2: [4, 7], 3: [8, 11], 4: [12, 15], 5: [16, 18], 6: [19, 21], 7: [22, 25] },
          'PAPER ONE': { 1: [0, 5], 2: [6, 10], 3: [11, 15], 4: [16, 22], 5: [23, 31], 6: [32, 38], 7: [39, 50] },
          'PAPER TWO': { 1: [0, 4], 2: [5, 8], 3: [9, 11], 4: [12, 14], 5: [15, 16], 6: [17, 19], 7: [20, 25] },
          FINAL: { 1: [0, 12], 2: [13, 25], 3: [26, 37], 4: [38, 51], 5: [52, 65], 6: [66, 78], 7: [79, 100] }
        }
      },
      november: {
        timezone0: {
          'INTERNAL ASSESSMENT': { 1: [0, 3], 2: [4, 7], 3: [8, 11], 4: [12, 15], 5: [16, 18], 6: [19, 21], 7: [22, 25] },
          'PAPER ONE': { 1: [0, 4], 2: [5, 8], 3: [9, 12], 4: [13, 21], 5: [22, 29], 6: [30, 38], 7: [39, 50] },
          'PAPER TWO': { 1: [0, 3], 2: [4, 7], 3: [8, 11], 4: [12, 14], 5: [15, 17], 6: [18, 20], 7: [21, 25] },
          FINAL: { 1: [0, 10], 2: [11, 22], 3: [23, 39], 4: [40, 53], 5: [54, 66], 6: [67, 80], 7: [81, 100] }
        },
        timezone1: {
          'INTERNAL ASSESSMENT': { 1: [0, 3], 2: [4, 7], 3: [8, 11], 4: [12, 15], 5: [16, 18], 6: [19, 21], 7: [22, 25] },
          'PAPER ONE': { 1: [0, 4], 2: [5, 8], 3: [9, 12], 4: [13, 21], 5: [22, 29], 6: [30, 38], 7: [39, 50] },
          'PAPER TWO': { 1: [0, 3], 2: [4, 7], 3: [8, 11], 4: [12, 14], 5: [15, 17], 6: [18, 20], 7: [21, 25] },
          FINAL: { 1: [0, 10], 2: [11, 22], 3: [23, 39], 4: [40, 53], 5: [54, 66], 6: [67, 80], 7: [81, 100] }
        },
        timezone2: {
          'INTERNAL ASSESSMENT': { 1: [0, 3], 2: [4, 7], 3: [8, 11], 4: [12, 15], 5: [16, 18], 6: [19, 21], 7: [22, 25] },
          'PAPER ONE': { 1: [0, 4], 2: [5, 8], 3: [9, 12], 4: [13, 21], 5: [22, 29], 6: [30, 38], 7: [39, 50] },
          'PAPER TWO': { 1: [0, 3], 2: [4, 7], 3: [8, 11], 4: [12, 14], 5: [15, 17], 6: [18, 20], 7: [21, 25] },
          FINAL: { 1: [0, 10], 2: [11, 22], 3: [23, 39], 4: [40, 53], 5: [54, 66], 6: [67, 80], 7: [81, 100] }
        }
      }
    }
  },
  'GLOBAL POLITICS': {
    HL: {
      may: {
        timezone1: {
          'EXTENSION ORAL': { 1: [0, 2], 2: [3, 4], 3: [5, 8], 4: [9, 11], 5: [12, 13], 6: [14, 16], 7: [17, 20] },
          'INTERNAL ASSESSMENT': { 1: [0, 2], 2: [3, 5], 3: [6, 8], 4: [9, 10], 5: [11, 13], 6: [14, 15], 7: [16, 20] },
          'PAPER ONE': { 1: [0, 2], 2: [3, 5], 3: [6, 8], 4: [9, 11], 5: [12, 13], 6: [14, 16], 7: [17, 25] },
          'PAPER TWO': { 1: [0, 8], 2: [9, 16], 3: [17, 21], 4: [22, 30], 5: [31, 39], 6: [40, 48], 7: [49, 75] },
          FINAL: { 1: [0, 10], 2: [11, 22], 3: [23, 34], 4: [35, 46], 5: [47, 57], 6: [58, 69], 7: [70, 100] }
        },
        timezone2: {
          'EXTENSION ORAL': { 1: [0, 2], 2: [3, 4], 3: [5, 8], 4: [9, 11], 5: [12, 13], 6: [14, 16], 7: [17, 20] },
          'INTERNAL ASSESSMENT': { 1: [0, 2], 2: [3, 5], 3: [6, 8], 4: [9, 10], 5: [11, 13], 6: [14, 15], 7: [16, 20] },
          'PAPER ONE': { 1: [0, 2], 2: [3, 5], 3: [6, 8], 4: [9, 11], 5: [12, 13], 6: [14, 16], 7: [17, 25] },
          'PAPER TWO': { 1: [0, 8], 2: [9, 16], 3: [17, 21], 4: [22, 30], 5: [31, 39], 6: [40, 48], 7: [49, 75] },
          FINAL: { 1: [0, 10], 2: [11, 22], 3: [23, 34], 4: [35, 46], 5: [47, 57], 6: [58, 69], 7: [70, 100] }
        }
      },
      november: {
        timezone0: {
          'EXTENSION ORAL': { 1: [0, 2], 2: [3, 4], 3: [5, 8], 4: [9, 11], 5: [12, 13], 6: [14, 16], 7: [17, 20] },
          'INTERNAL ASSESSMENT': { 1: [0, 2], 2: [3, 5], 3: [6, 8], 4: [9, 10], 5: [11, 13], 6: [14, 15], 7: [16, 20] },
          'PAPER ONE': { 1: [0, 2], 2: [3, 5], 3: [6, 8], 4: [9, 11], 5: [12, 15], 6: [16, 18], 7: [19, 25] },
          'PAPER TWO': { 1: [0, 7], 2: [8, 15], 3: [16, 21], 4: [22, 30], 5: [31, 39], 6: [40, 48], 7: [49, 75] },
          FINAL: { 1: [0, 9], 2: [10, 21], 3: [22, 34], 4: [35, 46], 5: [47, 59], 6: [60, 71], 7: [72, 100] }
        }
      }
    },
    SL: {
      may: {
        timezone1: {
          'INTERNAL ASSESSMENT': { 1: [0, 2], 2: [3, 5], 3: [6, 8], 4: [9, 10], 5: [11, 13], 6: [14, 15], 7: [16, 20] },
          'PAPER ONE': { 1: [0, 2], 2: [3, 5], 3: [6, 8], 4: [9, 11], 5: [12, 13], 6: [14, 16], 7: [17, 25] },
          'PAPER TWO': { 1: [0, 5], 2: [6, 10], 3: [11, 14], 4: [15, 18], 5: [19, 22], 6: [23, 27], 7: [28, 50] },
          FINAL: { 1: [0, 9], 2: [10, 21], 3: [22, 32], 4: [33, 42], 5: [43, 52], 6: [53, 62], 7: [63, 100] }
        },
        timezone2: {
          'INTERNAL ASSESSMENT': { 1: [0, 2], 2: [3, 5], 3: [6, 8], 4: [9, 10], 5: [11, 13], 6: [14, 15], 7: [16, 20] },
          'PAPER ONE': { 1: [0, 2], 2: [3, 5], 3: [6, 8], 4: [9, 11], 5: [12, 13], 6: [14, 16], 7: [17, 25] },
          'PAPER TWO': { 1: [0, 5], 2: [6, 10], 3: [11, 14], 4: [15, 18], 5: [19, 22], 6: [23, 27], 7: [28, 50] },
          FINAL: { 1: [0, 9], 2: [10, 21], 3: [22, 32], 4: [33, 42], 5: [43, 52], 6: [53, 62], 7: [63, 100] }
        }
      },
      november: {
        timezone0: {
          'INTERNAL ASSESSMENT': { 1: [0, 2], 2: [3, 5], 3: [6, 8], 4: [9, 10], 5: [11, 13], 6: [14, 15], 7: [16, 20] },
          'PAPER ONE': { 1: [0, 2], 2: [3, 5], 3: [6, 8], 4: [9, 11], 5: [12, 15], 6: [16, 18], 7: [19, 25] },
          'PAPER TWO': { 1: [0, 4], 2: [5, 9], 3: [10, 13], 4: [14, 18], 5: [19, 23], 6: [24, 28], 7: [29, 50] },
          FINAL: { 1: [0, 8], 2: [9, 20], 3: [21, 31], 4: [32, 42], 5: [43, 55], 6: [56, 66], 7: [67, 100] }
        }
      }
    }
  }
};

const paperMaxScores = {
  'ENGLISH A LIT': {
    HL: {
      ESSAY: 20,
      'INTERNAL ASSESSMENT (ORAL)': 40,
      'PAPER ONE': 30,
      'PAPER TWO': 30
    },
    SL: {
      'INTERNAL ASSESSMENT (ORAL)': 40,
      'PAPER ONE': 30,
      'PAPER TWO': 30
    }
  },
  'ENGLISH A LAL': {
    HL: {
      ESSAY: 20,
      'INTERNAL ASSESSMENT (ORAL)': 40,
      'PAPER ONE': 40,
      'PAPER TWO': 30
    },
    SL: {
      'INTERNAL ASSESSMENT (ORAL)': 40,
      'PAPER ONE': 20,
      'PAPER TWO': 30
    }
  },
  'ENGLISH A LIT AND PERF': {
    HL: {
      'TRANSFORMATIVE PERFORMANCE': 32,
      'PAPER ONE': 30,
      'WRITTEN ASSIGNMENT': 26
    },
    SL: {
      'TRANSFORMATIVE PERFORMANCE': 32,
      'PAPER ONE': 30,
      'WRITTEN ASSIGNMENT': 26
    }
  },
  'MATH ANALYSIS': {
    HL: {
      'PAPER ONE': 110,
      'PAPER TWO': 110,
      'PAPER THREE': 55,
      'EXPLORATION': 20
    },
    SL: {
      'PAPER ONE': 80,
      'PAPER TWO': 80,
      'EXPLORATION': 20
    }
  },
  'MATH AI': {
    HL: {
      'PAPER ONE': 110,
      'PAPER TWO': 110,
      'PAPER THREE': 55,
      'EXPLORATION': 20
    },
    SL: {
      'PAPER ONE': 80,
      'PAPER TWO': 80,
      'EXPLORATION': 20
    }
  },
  'HISTORY': {
    SL: {
      'PAPER ONE': 24,
      'PAPER TWO': 30,
      'INTERNAL ASSESSMENT': 25
    }
  },
  'GLOBAL POLITICS': {
    SL: {
      'PAPER ONE': 25,
      'PAPER TWO': 50,
      'INTERNAL ASSESSMENT': 20
    },
    HL: {
      'PAPER ONE': 25,
      'PAPER TWO': 75,
      'EXTENSION ORAL': 20,
      'INTERNAL ASSESSMENT': 20
    }
  },
  'PHILOSOPHY': {
    HL: {
      'PAPER ONE': 75,
      'PAPER TWO': 25,
      'PAPER THREE': 25,
      'INTERNAL ASSESSMENT': 25
    },
    SL: {
      'PAPER ONE': 50,
      'PAPER TWO': 25,
      'INTERNAL ASSESSMENT': 25
    }
  }
};

const GradePredictionScreen: React.FC<Props> = ({ navigation, route }) => {
  const { subject, userType } = route.params;
  const [selectedLevel, setSelectedLevel] = useState<'HL' | 'SL'>(() => {
    if (subject === 'ENGLISH A LIT AND PERF') return 'SL';
    if (subject === 'HISTORY') return 'SL';
    return 'HL';
  });
  const [selectedTimezone, setSelectedTimezone] = useState<'timezone0' | 'timezone1' | 'timezone2'>(() => {
    if (subject === 'MATH AI') return 'timezone0';
    return 'timezone1';
  });
  const [selectedSeason, setSelectedSeason] = useState<'november' | 'may'>(() => {
    if (subject === 'ENGLISH A LIT AND PERF') return 'may';
    if (subject === 'MATH AI') return 'november';
    if (subject === 'HISTORY') return 'may';
    if (subject === 'GLOBAL POLITICS') return 'may';
    return 'november';
  });
  const [scores, setScores] = useState<Record<string, number>>({});
  const [predictedGrade, setPredictedGrade] = useState<number | null>(null);

  const homeIconOpacity = useRef(new Animated.Value(1)).current;

  const isCombinationAvailable = (level: 'HL' | 'SL', season: 'november' | 'may', timezone: 'timezone0' | 'timezone1' | 'timezone2') => {
    if (subject === 'ENGLISH A LIT AND PERF') {
      return level === 'SL' && season === 'may' && (timezone === 'timezone1' || timezone === 'timezone2');
    }
    
    if (subject === 'MATH AI') {
      // HL November timezone 0
      if (level === 'HL' && season === 'november' && timezone === 'timezone0') return true;
      // HL May timezone 1 and 2
      if (level === 'HL' && season === 'may' && (timezone === 'timezone1' || timezone === 'timezone2')) return true;
      // SL November timezone 1 and 2
      if (level === 'SL' && season === 'november' && (timezone === 'timezone1' || timezone === 'timezone2')) return true;
      // SL May timezone 1 and 2
      if (level === 'SL' && season === 'may' && (timezone === 'timezone1' || timezone === 'timezone2')) return true;
      // All other combinations are not available
      return false;
    }
    
    if (subject === 'MATH ANALYSIS') {
      if (timezone === 'timezone0') {
        return level === 'HL' && season === 'november';
      }
      // All other combinations are available for Math Analysis
      return true;
    }
    
    if (subject === 'HISTORY') {
      // Only SL for May and November timezone 1 and 2 are available
      return level === 'SL' && (season === 'may' || season === 'november') && (timezone === 'timezone1' || timezone === 'timezone2');
    }
    
    if (subject === 'GLOBAL POLITICS') {
      // May HL and SL timezone 1 and 2, November HL and SL timezone 0
      if (season === 'may') {
        return timezone === 'timezone1' || timezone === 'timezone2';
      }
      if (season === 'november') {
        return timezone === 'timezone0';
      }
      return false;
    }
    
    // For all other subjects, all combinations are available
    return true;
  };

  // Function to find the first available combination for Math AI
  const getValidMathAICombination = (preferredLevel?: 'HL' | 'SL', preferredSeason?: 'november' | 'may', preferredTimezone?: 'timezone0' | 'timezone1' | 'timezone2') => {
    const combinations = [
      { level: 'HL' as const, season: 'november' as const, timezone: 'timezone0' as const },
      { level: 'HL' as const, season: 'may' as const, timezone: 'timezone1' as const },
      { level: 'HL' as const, season: 'may' as const, timezone: 'timezone2' as const },
      { level: 'SL' as const, season: 'november' as const, timezone: 'timezone1' as const },
      { level: 'SL' as const, season: 'november' as const, timezone: 'timezone2' as const },
      { level: 'SL' as const, season: 'may' as const, timezone: 'timezone1' as const },
      { level: 'SL' as const, season: 'may' as const, timezone: 'timezone2' as const },
    ];

    // Try to find combination that matches preferences
    if (preferredLevel && preferredSeason && preferredTimezone) {
      const preferred = combinations.find(c => c.level === preferredLevel && c.season === preferredSeason && c.timezone === preferredTimezone);
      if (preferred) return preferred;
    }

    // Try to find combination with preferred level
    if (preferredLevel) {
      const withLevel = combinations.find(c => c.level === preferredLevel);
      if (withLevel) return withLevel;
    }

    // Return first available combination
    return combinations[0];
  };

  const handleScroll = (event: any) => {
    const scrollY = event.nativeEvent.contentOffset.y;
    const fadeThreshold = 50;
    
    if (scrollY > fadeThreshold) {
      Animated.timing(homeIconOpacity, {
        toValue: 0,
        duration: 100,
        useNativeDriver: true,
      }).start();
    } else {
      Animated.timing(homeIconOpacity, {
        toValue: 1,
        duration: 100,
        useNativeDriver: true,
      }).start();
    }
  };

  const calculatePredictedGrade = () => {
    const subjectData = gradeBoundaries[subject as keyof typeof gradeBoundaries];
    if (!subjectData) return null;
    
    const levelData = (subjectData as any)[selectedLevel];
    if (!levelData) return null;
    
    const seasonData = (levelData as any)[selectedSeason];
    if (!seasonData) return null;
    
    const timezoneData = (seasonData as any)[selectedTimezone];
    if (!timezoneData) return null;
    
    const boundaries = timezoneData.FINAL;
    if (!boundaries) return null;

    const weightageData = paperWeightages[subject as keyof typeof paperWeightages];
    if (!weightageData || !(weightageData as any)[selectedLevel]) return null;
    
    const weights = (weightageData as any)[selectedLevel];
    const maxScoresData = paperMaxScores[subject as keyof typeof paperMaxScores];
    if (!maxScoresData || !(maxScoresData as any)[selectedLevel]) return null;
    
    const maxScores = (maxScoresData as any)[selectedLevel];

    let weightedScore = 0;
    
    Object.keys(scores).forEach(paper => {
      const rawScore = scores[paper] || 0;
      const maxScore = maxScores[paper as keyof typeof maxScores] || 1;
      const weight = weights[paper as keyof typeof weights] || 0;
      
      const percentage = (rawScore / maxScore) * 100;
      weightedScore += percentage * weight;
    });

    weightedScore = Math.round(weightedScore * 100) / 100;

    for (let grade = 1; grade <= 7; grade++) {
      const gradeRange = boundaries[grade as keyof typeof boundaries] as [number, number];
      if (gradeRange && weightedScore >= gradeRange[0] && weightedScore <= gradeRange[1]) {
        return grade;
      }
    }

    let closestGrade = 1;
    let minDistance = Infinity;
    
    for (let grade = 1; grade <= 7; grade++) {
      const gradeRange = boundaries[grade as keyof typeof boundaries] as [number, number];
      if (gradeRange) {
        const midPoint = (gradeRange[0] + gradeRange[1]) / 2;
        const distance = Math.abs(weightedScore - midPoint);
        if (distance < minDistance) {
          minDistance = distance;
          closestGrade = grade;
        }
      }
    }
    
    return closestGrade;
  };

  const calculateWeightedScore = () => {
    const weightageData = paperWeightages[subject as keyof typeof paperWeightages];
    if (!weightageData || !(weightageData as any)[selectedLevel]) return 0;
    
    const weights = (weightageData as any)[selectedLevel];
    const maxScoresData = paperMaxScores[subject as keyof typeof paperMaxScores];
    if (!maxScoresData || !(maxScoresData as any)[selectedLevel]) return 0;
    
    const maxScores = (maxScoresData as any)[selectedLevel];

    let weightedScore = 0;
    
    Object.keys(scores).forEach(paper => {
      const rawScore = scores[paper] || 0;
      const maxScore = maxScores[paper as keyof typeof maxScores] || 1;
      const weight = weights[paper as keyof typeof weights] || 0;
      
      // Convert to percentage and apply weight
      const percentage = (rawScore / maxScore) * 100;
      weightedScore += percentage * weight;
    });

    return Math.round(weightedScore * 10) / 10; // Round to 1 decimal place
  };

  // Update scores when level changes
  useEffect(() => {
    const subjectData = paperMaxScores[subject as keyof typeof paperMaxScores];
    if (subjectData && (subjectData as any)[selectedLevel]) {
      const papers = Object.keys((subjectData as any)[selectedLevel]);
      const newScores: Record<string, number> = {};
      papers.forEach(paper => {
        newScores[paper] = 0;
      });
      setScores(newScores);
    }
  }, [selectedLevel, selectedSeason, subject]);

  useEffect(() => {
    const grade = calculatePredictedGrade();
    setPredictedGrade(grade);
  }, [scores, selectedLevel, selectedTimezone, selectedSeason]);

  useEffect(() => {
    navigation.setOptions({
      headerShown: false,
    });
  }, [navigation]);

  let [fontsLoaded] = useFonts({
    'ScopeOne-Regular': require('../../assets/fonts/ScopeOne-Regular.ttf'),
  });
  if (!fontsLoaded) {
    return <AppLoading />;
  }

  const subjectData = paperMaxScores[subject as keyof typeof paperMaxScores];
  const maxScores = subjectData ? (subjectData as any)[selectedLevel] : null;
  const papers = maxScores ? Object.keys(maxScores) : [];
  const totalMaxScore = maxScores ? Object.values(maxScores).reduce((sum: number, score: any) => sum + score, 0) : 0;

  return (
    <ImageBackground
      source={require('../../assets/images/entry-bg.png')}
      style={{ flex: 1, width: '100%', height: '100%' }}
      resizeMode="cover"
    >
      {/* Home icon top left */}
      <Animated.View style={{ position: 'absolute', top: 56, left: 16, zIndex: 100, flexDirection: 'row', alignItems: 'center', opacity: homeIconOpacity }}>
        <Feather
          name="arrow-left"
          size={20}
          color="#7EC3FF"
          onPress={() => navigation.goBack()}
          style={{ cursor: 'pointer' }}
          accessibilityRole="button"
          accessibilityLabel="Go Back"
        />
      </Animated.View>

      <ScrollView 
        contentContainerStyle={{ paddingTop: 112, paddingBottom: 32, paddingHorizontal: 16 }}
        onScroll={handleScroll}
        scrollEventThrottle={16}
      >
        {/* Header */}
        <View style={{ marginBottom: 32, alignItems: 'center' }}>
          <Text style={{ 
            fontSize: 26, 
            color: '#fff', 
            fontFamily: 'ScopeOne-Regular', 
            fontWeight: 'bold', 
            marginBottom: 8,
            textAlign: 'center'
          }}>
            Grade Prediction
          </Text>
          <Text style={{ 
            fontSize: 18, 
            color: '#7EC3FF', 
            fontFamily: 'ScopeOne-Regular',
            textAlign: 'center',
            marginBottom: 8
          }}>
            {subject}
          </Text>
          {subject === 'ENGLISH A LIT AND PERF' && (
            <Text style={{ 
              fontSize: 14, 
              color: '#FFA500', 
              fontFamily: 'ScopeOne-Regular',
              textAlign: 'center',
              marginBottom: 8,
              fontStyle: 'italic'
            }}>
              Note: Only May SL boundaries are available for this subject
            </Text>
          )}
        </View>

        {/* Level Selection */}
        <View style={{ 
          borderRadius: 16, 
          borderWidth: 1, 
          borderColor: '#7EC3FF', 
          backgroundColor: 'rgba(182,199,247,0.12)', 
          marginBottom: 24, 
          overflow: 'hidden' 
        }}>
          <View style={{ padding: 20, paddingBottom: 16 }}>
            <Text style={{ fontSize: 18, color: '#fff', fontFamily: 'ScopeOne-Regular', fontWeight: 'bold', marginBottom: 16 }}>
              Select Level
            </Text>
            <View style={{ flexDirection: 'row', gap: 12 }}>
              {['HL', 'SL'].map((level) => {
                const isAvailable = isCombinationAvailable(level as 'HL' | 'SL', selectedSeason, selectedTimezone);
                const isSelected = selectedLevel === level;
                
                return (
                  <TouchableOpacity
                    key={level}
                    onPress={() => {
                      if (subject === 'MATH AI') {
                        // For Math AI, always use smart selection logic regardless of current availability
                        const validCombo = getValidMathAICombination(level as 'HL' | 'SL', selectedSeason, selectedTimezone);
                        setSelectedLevel(validCombo.level);
                        setSelectedSeason(validCombo.season);
                        setSelectedTimezone(validCombo.timezone);
                      } else if (isAvailable) {
                        setSelectedLevel(level as 'HL' | 'SL');
                        // After changing level, check if current timezone is still valid, if not, find a valid one
                        if (!isCombinationAvailable(level as 'HL' | 'SL', selectedSeason, selectedTimezone)) {
                          const timezones = ['timezone0', 'timezone1', 'timezone2'];
                          const validTimezone = timezones.find(tz => 
                            isCombinationAvailable(level as 'HL' | 'SL', selectedSeason, tz as 'timezone0' | 'timezone1' | 'timezone2')
                          );
                          if (validTimezone) {
                            setSelectedTimezone(validTimezone as 'timezone0' | 'timezone1' | 'timezone2');
                          }
                        }
                      }
                    }}
                    disabled={subject !== 'MATH AI' && !isAvailable}
                    style={{
                      flex: 1,
                      padding: 12,
                      borderRadius: 12,
                      borderWidth: 1,
                      borderColor: isSelected ? '#7EC3FF' : (isAvailable ? '#444' : '#333'),
                      backgroundColor: isSelected ? 'rgba(126, 195, 255, 0.2)' : (isAvailable ? 'rgba(68, 68, 68, 0.2)' : 'rgba(51, 51, 51, 0.1)'),
                      opacity: isAvailable ? 1 : 0.5,
                    }}
                  >
                    <Text style={{
                      color: isSelected ? '#7EC3FF' : (isAvailable ? '#B6B6B6' : '#666'),
                      fontFamily: 'ScopeOne-Regular',
                      textAlign: 'center',
                      fontWeight: isSelected ? 'bold' : 'normal'
                    }}>
                      {level}
                      {!isAvailable && subject === 'ENGLISH A LIT AND PERF' ? ' (N/A)' : ''}
                    </Text>
                  </TouchableOpacity>
                );
              })}
            </View>
          </View>
        </View>

        {/* Timezone Selection */}
        <View style={{ 
          borderRadius: 16, 
          borderWidth: 1, 
          borderColor: '#7EC3FF', 
          backgroundColor: 'rgba(182,199,247,0.12)', 
          marginBottom: 24, 
          overflow: 'hidden' 
        }}>
          <View style={{ padding: 20, paddingBottom: 16 }}>
            <Text style={{ fontSize: 18, color: '#fff', fontFamily: 'ScopeOne-Regular', fontWeight: 'bold', marginBottom: 16 }}>
              Select Timezone
            </Text>
            <View style={{ flexDirection: 'row', gap: 12 }}>
              {[
                { key: 'timezone0', label: 'Timezone 0' },
                { key: 'timezone1', label: 'Timezone 1' },
                { key: 'timezone2', label: 'Timezone 2' }
              ].map((timezone) => {
                const isAvailable = isCombinationAvailable(selectedLevel, selectedSeason, timezone.key as 'timezone0' | 'timezone1' | 'timezone2');
                const isSelected = selectedTimezone === timezone.key;
                
                return (
                  <TouchableOpacity
                    key={timezone.key}
                    onPress={() => {
                      if (subject === 'MATH AI') {
                        // For Math AI, always use smart selection logic regardless of current availability
                        const validCombo = getValidMathAICombination(selectedLevel, selectedSeason, timezone.key as 'timezone0' | 'timezone1' | 'timezone2');
                        setSelectedLevel(validCombo.level);
                        setSelectedSeason(validCombo.season);
                        setSelectedTimezone(validCombo.timezone);
                      } else if (isAvailable) {
                        setSelectedTimezone(timezone.key as 'timezone0' | 'timezone1' | 'timezone2');
                      }
                    }}
                    disabled={subject !== 'MATH AI' && !isAvailable}
                    style={{
                      flex: 1,
                      padding: 12,
                      borderRadius: 12,
                      borderWidth: 1,
                      borderColor: isSelected ? '#7EC3FF' : (isAvailable ? '#444' : '#333'),
                      backgroundColor: isSelected ? 'rgba(126, 195, 255, 0.2)' : (isAvailable ? 'rgba(68, 68, 68, 0.2)' : 'rgba(51, 51, 51, 0.1)'),
                      opacity: isAvailable ? 1 : 0.5,
                    }}
                  >
                    <Text style={{
                      color: isSelected ? '#7EC3FF' : (isAvailable ? '#B6B6B6' : '#666'),
                      fontFamily: 'ScopeOne-Regular',
                      textAlign: 'center',
                      fontWeight: isSelected ? 'bold' : 'normal'
                    }}>
                      {timezone.label}
                      {!isAvailable && subject === 'ENGLISH A LIT AND PERF' ? ' (N/A)' : ''}
                    </Text>
                  </TouchableOpacity>
                );
              })}
            </View>
          </View>
        </View>

        {/* Examination Season Selection */}
        <View style={{ 
          borderRadius: 16, 
          borderWidth: 1, 
          borderColor: '#7EC3FF', 
          backgroundColor: 'rgba(182,199,247,0.12)', 
          marginBottom: 24, 
          overflow: 'hidden' 
        }}>
          <View style={{ padding: 20, paddingBottom: 16 }}>
            <Text style={{ fontSize: 18, color: '#fff', fontFamily: 'ScopeOne-Regular', fontWeight: 'bold', marginBottom: 16 }}>
              Select Examination Season
            </Text>
            <View style={{ flexDirection: 'row', gap: 12 }}>
              {[
                { key: 'november', label: 'November' },
                { key: 'may', label: 'May' }
              ].map((season) => {
                // Check if ANY combination is available for this season (not just current level/timezone)
                const isAvailable = ['HL', 'SL'].some(level => 
                  ['timezone0', 'timezone1', 'timezone2'].some(timezone => 
                    isCombinationAvailable(level as 'HL' | 'SL', season.key as 'november' | 'may', timezone as 'timezone0' | 'timezone1' | 'timezone2')
                  )
                );
                const isSelected = selectedSeason === season.key;
                
                return (
                  <TouchableOpacity
                    key={season.key}
                    onPress={() => {
                      if (subject === 'MATH AI') {
                        // For Math AI, use smart selection logic
                        const validCombo = getValidMathAICombination(selectedLevel, season.key as 'november' | 'may', selectedTimezone);
                        setSelectedLevel(validCombo.level);
                        setSelectedSeason(validCombo.season);
                        setSelectedTimezone(validCombo.timezone);
                      } else if (isAvailable) {
                        setSelectedSeason(season.key as 'november' | 'may');
                        // After changing season, check if current level and timezone are still valid
                        if (!isCombinationAvailable(selectedLevel, season.key as 'november' | 'may', selectedTimezone)) {
                          // Try to find a valid combination with current level first
                          const timezones = ['timezone0', 'timezone1', 'timezone2'];
                          const validTimezone = timezones.find(tz => 
                            isCombinationAvailable(selectedLevel, season.key as 'november' | 'may', tz as 'timezone0' | 'timezone1' | 'timezone2')
                          );
                          
                          if (validTimezone) {
                            setSelectedTimezone(validTimezone as 'timezone0' | 'timezone1' | 'timezone2');
                          } else {
                            // If no valid timezone with current level, try the other level
                            const otherLevel = selectedLevel === 'HL' ? 'SL' : 'HL';
                            const validTimezoneOtherLevel = timezones.find(tz => 
                              isCombinationAvailable(otherLevel, season.key as 'november' | 'may', tz as 'timezone0' | 'timezone1' | 'timezone2')
                            );
                            
                            if (validTimezoneOtherLevel) {
                              setSelectedLevel(otherLevel);
                              setSelectedTimezone(validTimezoneOtherLevel as 'timezone0' | 'timezone1' | 'timezone2');
                            }
                          }
                        }
                      }
                    }}
                    disabled={subject !== 'MATH AI' && !isAvailable}
                    style={{
                      flex: 1,
                      padding: 12,
                      borderRadius: 12,
                      borderWidth: 1,
                      borderColor: isSelected ? '#7EC3FF' : (isAvailable ? '#444' : '#333'),
                      backgroundColor: isSelected ? 'rgba(126, 195, 255, 0.2)' : (isAvailable ? 'rgba(68, 68, 68, 0.2)' : 'rgba(51, 51, 51, 0.1)'),
                      opacity: isAvailable ? 1 : 0.5,
                    }}
                  >
                    <Text style={{
                      color: isSelected ? '#7EC3FF' : (isAvailable ? '#B6B6B6' : '#666'),
                      fontFamily: 'ScopeOne-Regular',
                      textAlign: 'center',
                      fontWeight: isSelected ? 'bold' : 'normal'
                    }}>
                      {season.label}
                      {!isAvailable && subject === 'ENGLISH A LIT AND PERF' ? ' (N/A)' : ''}
                    </Text>
                  </TouchableOpacity>
                );
              })}
            </View>
          </View>
        </View>

        {/* Paper Scores */}
        <View style={{ 
          borderRadius: 16, 
          borderWidth: 1, 
          borderColor: '#7EC3FF', 
          backgroundColor: 'rgba(182,199,247,0.12)', 
          marginBottom: 24, 
          overflow: 'hidden' 
        }}>
          <View style={{ padding: 20 }}>
            <Text style={{ fontSize: 18, color: '#fff', fontFamily: 'ScopeOne-Regular', fontWeight: 'bold', marginBottom: 20 }}>
              Enter Your Scores
            </Text>
            
            {papers.map((paper) => {
              const weightageData = paperWeightages[subject as keyof typeof paperWeightages];
              const weight = (weightageData as any)?.[selectedLevel]?.[paper] || 0;
              const rawScore = scores[paper] || 0;
              const maxScore = maxScores?.[paper as keyof typeof maxScores] || 0;
              const percentage = maxScore > 0 ? (rawScore / maxScore) * 100 : 0;
              const contribution = percentage * weight;
              
              return (
                <View key={paper} style={{ marginBottom: 24 }}>
                  <View style={{ flexDirection: 'row', justifyContent: 'space-between', alignItems: 'center', marginBottom: 8 }}>
                    <Text style={{ color: '#7EC3FF', fontFamily: 'ScopeOne-Regular', fontSize: 16, flex: 1 }}>
                      {paper}
                    </Text>
                    <Text style={{ color: '#fff', fontFamily: 'ScopeOne-Regular', fontSize: 16, fontWeight: 'bold' }}>
                      {rawScore} / {maxScore}
                    </Text>
                  </View>
                  <View style={{ flexDirection: 'row', justifyContent: 'space-between', alignItems: 'center', marginBottom: 12 }}>
                    <Text style={{ color: '#B6B6B6', fontFamily: 'ScopeOne-Regular', fontSize: 14 }}>
                      Weight: {Math.round(weight * 100)}%
                    </Text>
                    <Text style={{ color: '#B6B6B6', fontFamily: 'ScopeOne-Regular', fontSize: 14 }}>
                      Contributes: {contribution.toFixed(1)}%
                    </Text>
                  </View>
                  <Slider
                    style={{ width: '100%', height: 40 }}
                    minimumValue={0}
                    maximumValue={maxScores?.[paper as keyof typeof maxScores] || 0}
                    value={scores[paper] || 0}
                    onValueChange={(value: number) => setScores(prev => ({ ...prev, [paper]: Math.round(value) }))}
                    minimumTrackTintColor="#7EC3FF"
                    maximumTrackTintColor="#444"
                  />
                </View>
              );
            })}
          </View>
        </View>

        {/* Predicted Grade */}
        <View style={{ 
          borderRadius: 16, 
          borderWidth: 1, 
          borderColor: '#7EC3FF', 
          backgroundColor: 'rgba(182,199,247,0.12)', 
          marginBottom: 24, 
          overflow: 'hidden' 
        }}>
          <LinearGradient
            colors={['rgba(126, 195, 255, 0.15)', 'rgba(126, 195, 255, 0.05)']}
            style={{ padding: 24 }}
          >
            <View style={{ alignItems: 'center' }}>
              <Text style={{ fontSize: 18, color: '#7EC3FF', fontFamily: 'ScopeOne-Regular', marginBottom: 12 }}>
                Predicted Grade
              </Text>
              <View style={{
                width: 80,
                height: 80,
                borderRadius: 40,
                borderWidth: 3,
                borderColor: '#7EC3FF',
                justifyContent: 'center',
                alignItems: 'center',
                backgroundColor: 'rgba(126, 195, 255, 0.1)'
              }}>
                <Text style={{ 
                  fontSize: 36, 
                  color: '#7EC3FF', 
                  fontFamily: 'ScopeOne-Regular', 
                  fontWeight: 'bold' 
                }}>
                  {predictedGrade || '-'}
                </Text>
              </View>
              <Text style={{ 
                fontSize: 14, 
                color: '#B6B6B6', 
                fontFamily: 'ScopeOne-Regular', 
                textAlign: 'center',
                marginTop: 12
              }}>
                Weighted Score: {calculateWeightedScore()}%
              </Text>
            </View>
          </LinearGradient>
        </View>

        {/* Disclaimer */}
        <View style={{ alignItems: 'center', marginTop: 16, marginBottom: 8 }}>
          <Text style={{
            fontSize: 12,
            color: '#B6B6B6',
            textAlign: 'center',
            lineHeight: 18,
            fontFamily: 'ScopeOne-Regular',
            fontWeight: '400',
          }}>
            This prediction is based on historical grade boundaries and is for guidance only.
          </Text>
        </View>
      </ScrollView>
    </ImageBackground>
  );
};

export default GradePredictionScreen; 